--- a/ath10k-4.16/coredump.c
+++ b/ath10k-4.16/coredump.c
@@ -851,7 +851,9 @@ static struct ath10k_dump_file_data *ath
 	if (test_bit(ATH10K_FW_CRASH_DUMP_RAM_DATA, &ath10k_coredump_mask))
 		len += sizeof(*dump_tlv) + crash_data->ramdump_buf_len;
 
+#ifdef CONFIG_ATH10K_DEBUGFS
 	len += sizeof(*dump_tlv) + sizeof(ar->debug.dbglog_entry_data);
+#endif
 	len += sizeof(*dump_tlv) + sizeof(crash_data->stack_buf);
 	len += sizeof(*dump_tlv) + sizeof(crash_data->exc_stack_buf);
 
@@ -945,6 +947,7 @@ static struct ath10k_dump_file_data *ath
 		sofar += sizeof(*dump_tlv) + crash_data->ramdump_buf_len;
 	}
 
+#ifdef CONFIG_ATH10K_DEBUGFS
 	/* Gather dbg-log */
 	tmp = sizeof(ar->debug.dbglog_entry_data);
 	dump_tlv = (struct ath10k_tlv_dump_data *)(buf + sofar);
@@ -959,6 +962,7 @@ static struct ath10k_dump_file_data *ath
 	dbglog_storage->tail_idx =
 		cpu_to_le32(ar->debug.dbglog_entry_data.tail_idx);
 	sofar += sizeof(*dump_tlv) + tmp;
+#endif
 
 	/* Gather firmware stack dump */
 	tmp = sizeof(crash_data->stack_buf);
